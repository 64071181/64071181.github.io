<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mok's Group Limited | whatsapp auto reply</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(145deg, #323232, #182d42);
            color: #ecf0f1;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 2em;
            text-shadow: 2px 2px 4px #000;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            border-radius: 12px;
            background: #2f3030;
            box-shadow: 4px 4px 8px #4c4c4c;
        }

        label, p {
            margin: 10px 0 5px;
        }

        input, textarea, button {
            width: 100%;
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 8px;
            border: none;
            outline: none;
        }

        #執行ws王{background: #666666;color: #000000;font-size: 48px;}
        
        button {
            background-color: #000000;
            color: white;
            cursor: pointer;
        }

        button:hover {
            background-color: #484949;
        }

        .hidden {
            display: none;
        }

        .reply-group {
            margin-bottom: 10px;
        }
        

    </style>
</head>
<body>
    <h1>Mok's Group Limited | whatsapp auto reply</h1>
    
    <div class="container">
        <samp>202503292012</samp>

        <hr>
        <!-- 部份1: 帳號 -->
        <label>手機地區號</label>
        <input id="regionCode" type="text" placeholder="例如: 86" title="例如: 86" required>
        <label>WhatsApp 號碼</label>
        <input id="whatsappNumber" type="text" placeholder="輸入WhatsApp號碼" title="輸入WhatsApp號碼" required>

        <!-- 部份2: 回覆內容 -->
        <h3>回覆內容</h3>
        <samp>不能用表情符號</samp>
        <div id="replies"></div>
        <button onclick="addReply()">增加回覆內容</button>

        <!-- 部份3: 登入流程_xpaths -->
        <div id="xpaths" class="hidden">
            <label for="loginXpaths">登入流程_xpaths</label>
            <textarea id="loginXpaths" rows="10">
# 必須按此排列
'手机号输入':'//*[@id="app"]/div/div[2]/div[2]/div[*]/div/div/div[2]/div[1]/div[5]/span/div',
'国家选择':'//*[@id="app"]/div/div[2]/div[2]/div[*]/div/div/div[3]/div[1]/div[1]/button/div/div/div',
'国家代码':'//*[@id="wa-popovers-bucket"]/div/div[2]/div/div[1]/div/div[2]/div/div/p',
'地区选择':'//*[@id="wa-popovers-bucket"]/div/div[2]/div/div[2]/div/div/div/div/div/div/button/div/div/div[2]/div/div/div',
'电话号码':'//*[@id="app"]/div/div[2]/div[2]/div[1]/div/div/div[3]/div[1]/div[2]/div/div/div/form/input',
'登入按钮':'//*[@id="app"]/div/div[2]/div[2]/div[1]/div/div/div[3]/div[3]/button/div/div'
            </textarea>
            <label for="otherXpaths">其他_xpaths</label>
            <textarea id="otherXpaths" rows="10">
'聯絡人框架':'//*[@id="pane-side"]',
'验证字符頭':'//*[@id="app"]/div/div[2]/div[2]/div[1]/div/div/div[4]/div/div/div/div[',
'验证字符尾':']/span',
'對話列表':'//*[@id="pane-side"]/div[2]/div/div/div',
'客戶信息位':'.//div/div/div/div[2]/div[2]/div[1]/span/span',
'對話輸入框':'//*[@id="main"]/footer/div[1]/div/span/div/div[2]/div[1]/div[2]/div/p',
'正在載入您的對話':'//*[@id="app"]/div/div[2]/div[2]'
            </textarea>
        </div>

        <hr>
        <!-- 部份4: 執行ws王 -->
        <button id="執行ws王" onclick="executeWs()">執行ws王</button>
        
    </div>

    <script>
        function saveToLocalStorage(key, value) {
            localStorage.setItem(key, value);
        }

        function loadFromLocalStorage(key) {
            return localStorage.getItem(key);
        }

        function addReply(text = '', response = '') {
            const replies = document.getElementById('replies');
            const replyGroup = document.createElement('div');
            replyGroup.classList.add('reply-group');

            replyGroup.innerHTML = `
                <input placeholder="當客戶說..." title="當客戶說" value="${text}">
                <textarea placeholder="自動回覆..." title="自動回覆" >${response}</textarea>
            `;
            replies.appendChild(replyGroup);
        }

        async function executeWs() {
            const regionCode = document.getElementById('regionCode').value;
            const whatsappNumber = document.getElementById('whatsappNumber').value;
            const loginXpaths = document.getElementById('loginXpaths').value.trim();
            const otherXpaths = document.getElementById('otherXpaths').value.trim();

            const replyGroups = document.querySelectorAll('.reply-group');
            const replies = {};
            replyGroups.forEach(group => {
                const text = group.querySelector('input').value;
                const response = group.querySelector('textarea').value;
                if (text && response) {
                    replies[text] = response;
                }
            });

            // 等待 SHA256 完成
            const hashValue = await sha256(regionCode + whatsappNumber);

            // 輸出結果
            const result = `
帳號1181 = "${hashValue}"
国家代码 = "${regionCode}"
电话号码 = "${whatsappNumber}"
回覆內容 = ${JSON.stringify(replies, null, 2)}
登入流程_xpaths = {${loginXpaths || '無'}}
其他_xpaths = {${otherXpaths || '無'}}


            `;
            
            navigator.clipboard.writeText(result);
            alert("已複製執行碼！請執行 ws王 程式,並貼上執行碼!!");
            //window.open("https://64071181.github.io/");
        }

        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        function loadSavedData() {
    // 帳號部分
    document.getElementById('regionCode').value = loadFromLocalStorage('regionCode') || '';
    document.getElementById('whatsappNumber').value = loadFromLocalStorage('whatsappNumber') || '';

    // loginXpaths 部分：如果 localStorage 沒有資料或只有空白，就保留預設值
    let savedLoginXpaths = loadFromLocalStorage('loginXpaths');
    const loginXpathElem = document.getElementById('loginXpaths');
    if (!savedLoginXpaths || savedLoginXpaths.trim() === '') {
        savedLoginXpaths = loginXpathElem.value.trim();
        saveToLocalStorage('loginXpaths', savedLoginXpaths);
    } else {
        loginXpathElem.value = savedLoginXpaths.trim();
    }

    // otherXpaths 部分：同上
    let savedOtherXpaths = loadFromLocalStorage('otherXpaths');
    const otherXpathElem = document.getElementById('otherXpaths');
    if (!savedOtherXpaths || savedOtherXpaths.trim() === '') {
        savedOtherXpaths = otherXpathElem.value.trim();
        saveToLocalStorage('otherXpaths', savedOtherXpaths);
    } else {
        otherXpathElem.value = savedOtherXpaths.trim();
    }

    // 載入回覆內容
    const savedReplies = JSON.parse(loadFromLocalStorage('replies') || '{}');
    Object.keys(savedReplies).forEach(key => {
        addReply(key, savedReplies[key]);
    });
}

        window.addEventListener('beforeunload', () => {
            const replyGroups = document.querySelectorAll('.reply-group');
            const replies = {};
            replyGroups.forEach(group => {
                const text = group.querySelector('input').value;
                const response = group.querySelector('textarea').value;
                if (text && response) {
                    replies[text] = response;
                }
            });

            // 儲存各項資料
            saveToLocalStorage('regionCode', document.getElementById('regionCode').value);
            saveToLocalStorage('whatsappNumber', document.getElementById('whatsappNumber').value);
            saveToLocalStorage('loginXpaths', document.getElementById('loginXpaths').value);
            saveToLocalStorage('otherXpaths', document.getElementById('otherXpaths').value);
            saveToLocalStorage('replies', JSON.stringify(replies));
        });

        loadSavedData();
    </script>
</body>
</html>
